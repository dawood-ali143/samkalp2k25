<!DOCTYPE html>
<html>
<head>
  <title>Event Payment</title>
</head>
<body>
  <h2>Event Registration & Payment</h2>
  <form id="paymentForm">
    <label>Roll Number:</label>
    <input type="text" name="rollno" required><br>

    <label>Student Name:</label>
    <input type="text" name="name" required><br>

    <label>Branch:</label>
    <input type="text" name="branch" required><br>

    <label>Select Event:</label>
    <select name="event" required>
      <option value="Hackathon">Hackathon</option>
      <option value="Workshop">Workshop</option>
    </select><br><br>

    <button type="button" onclick="payNow()">Pay</button>
  </form>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    function payNow() {
      fetch("/create-order", { method: "POST", body: new FormData(document.getElementById("paymentForm")) })
        .then(res => res.json())
        .then(data => {
          var options = {
            "key": "RAZORPAY_KEY_ID",
            "amount": data.amount,
            "currency": "INR",
            "name": "Event Payment",
            "description": "Event Registration Fee",
            "order_id": data.id,
            "handler": function (response) {
              fetch("/verify-payment", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  rollno: document.querySelector("[name=rollno]").value,
                  name: document.querySelector("[name=name]").value,
                  branch: document.querySelector("[name=branch]").value,
                  event: document.querySelector("[name=event]").value,
                  razorpay_payment_id: response.razorpay_payment_id,
                  razorpay_order_id: response.razorpay_order_id,
                  razorpay_signature: response.razorpay_signature
                })
              });
              alert("Payment Successful!");
            }
          };
          var rzp = new Razorpay(options);
          rzp.open();
        });
    }
  </script>
</body>
</html>
